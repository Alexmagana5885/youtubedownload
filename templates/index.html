<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <title>YouTube Downloader</title>

  </head>
  <body>
    <div class="container">
      <header>
        <h1>YouTube Downloader</h1>
        <p>Paste your link in the space below...</p>
      </header>

      <div class="status" id="status"></div>

      <form id="urlSubmit" action="/download" method="POST">
        <input
          type="url"
          id="link"
          name="downloadlink"
          placeholder="Enter YouTube video link"
          required
        />
        <button type="submit" id="downloadBtn">Download</button>
      </form>

      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <script>
      // Handle the download button click
      document
        .getElementById("downloadBtn")
        .addEventListener("click", async function (e) {
          e.preventDefault(); // Prevent default form submission
          const link = document.getElementById("link").value;
          const status = document.getElementById("status");

          // Check if the input link is valid
          if (link === "") {
            status.textContent = "Please enter a valid YouTube link.";
            status.style.color = "red";
            return;
          }

          status.textContent = "Downloading...";
          status.style.color = "#007bff";

          // Send the POST request to the backend
          try {
            const formData = new FormData();
            formData.append("downloadlink", link); // Sending as form data

            const response = await fetch("/download", {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              // Once the download starts, start the progress tracking
              const eventSource = new EventSource("/download");

              eventSource.onmessage = function (event) {
                const progressData = JSON.parse(event.data);
                const progressBar = document.getElementById("progressBar");

                // Update the progress bar width based on the server progress
                progressBar.style.width = `${progressData.progress}%`;

                // If download is complete, show a success message
                if (progressData.progress >= 100) {
                  eventSource.close();
                  document.getElementById("status").textContent =
                    "Download Completed!";
                  document.getElementById("status").style.color = "green";
                }
              };
            } else {
              status.textContent = "Failed to start download.";
              status.style.color = "red";
            }
          } catch (error) {
            status.textContent = "An error occurred while downloading.";
            status.style.color = "red";
          }
        });
    </script>
  </body>
</html>
